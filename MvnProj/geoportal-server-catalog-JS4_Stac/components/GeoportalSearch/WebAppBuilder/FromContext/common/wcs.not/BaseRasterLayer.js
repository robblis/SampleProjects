define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/array","dojo/sniff","dojo/dom-construct","dojo/dom-style","dojo/number","esri/lang","esri/domUtils","esri/layers/layer","esri/SpatialReference","esri/geometry/Point"],function(n,t,i,r,u,f,e,o,s,h,c){return n([c],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(n,t){this.drawMode=t&&t.drawMode!==undefined?t.drawMode:!0;this.drawType=t&&t.drawType?t.drawType:"2d";this.pixelData=null;this._initialize(n,t)},setDrawMode:function(n){this.drawMode=n},setOpacity:function(n){if(this.opacity!=n)this.onOpacityChange(this.opacity=n)},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||u("ie")<10){this.onError(new Error("Unable to refresh. This layer is not supported in the current browser."));return}this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&this.drawType==="2d"&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();this._displayTimer=this._displayTimer||setTimeout(t.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},getCurrentResolution:function(){var n=this._map.extent;return{x:(n.xmax-n.xmin)/this._map.width,y:(n.ymax-n.ymin)/this._map.height}},onOpacityChange:function(){},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},_toggleTime:function(){},_setMap:function(n,t){var r,u;return this.inherited(arguments),r=this._canvas=f.create("canvas",{id:"canvas",width:n.width+"px",height:n.height+"px",style:"position: absolute; left: 0px; top: 0px;"},t),s.isDefined(this.opacity)&&e.set(r,"opacity",this.opacity),this._context=r.getContext(this.drawType),this._context||console.error("Unable to create the context. This browser might not support <canvas> elements."),this._mapWidth=n.width,this._mapHeight=n.height,this._connects=[],this._connects.push(i.connect(n,"onPan",this,this._panHandler)),this._connects.push(i.connect(n,"onPanEnd",this,this._panEndHandler)),this._connects.push(i.connect(n,"onZoom",this,this._onZoomHandler)),this._connects.push(i.connect(n,"onZoomEnd",this,this._onZoomEndHandler)),this._connects.push(i.connect(n,"onResize",this,this._onResizeHandler)),this._connects.push(i.connect(n,"onExtentChange",this,this._extentChangeHandler)),this._connects.push(i.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler)),this._connects.push(i.connect(this,"onOpacityChange",this,this._opacityChangeHandler)),this._startRect={left:0,top:0,width:n.width,height:n.height},this.evaluateSuspension(),this.suspended&&!n.loaded&&(u=i.connect(n,"onLoad",this,function(){i.disconnect(u);u=null;this.evaluateSuspension()})),r},_unsetMap:function(n,t){r.forEach(this._connects,i.disconnect,this);this._canvas&&t.removeChild(this._canvas);this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return this._map&&this._canvas&&this._context?!0:!1},_requestDataErrorHandler:function(n){if(n.name!=="CancelError"){this.clear();this.onError(n)}},_drawPixelData:function(){var f;if(e.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),this._startRect={left:0,top:0,width:this._map.width,height:this._map.height},this._canDraw&&this.drawMode){if(f=this._useBrowserDecoding(),f){this._fireUpdateEnd();return}if(this.drawMode){if(!this.pixelData||!this.pixelData.pixelBlock){this.clear();return}var u=this.pixelData.pixelBlock,o=this._context,s=o.createImageData(u.width,u.height);s.data.set(u.getAsRGBA());var n=this.pixelData.extent,t=this._map.extent,i=this.getCurrentResolution(),r={x:0,y:0};Math.abs(n.xmin-t.xmin)>i.x&&(r.x=Math.round((n.xmin-t.xmin)/i.x));Math.abs(t.ymax-n.ymax)>i.y&&(r.y=Math.round((t.ymax-n.ymax)/i.y));this.clear();o.putImageData(s,r.x,r.y);this._fireUpdateEnd()}}},_panHandler:function(n,t){e.set(this._canvas,{left:this._startRect.left+t.x+"px",top:this._startRect.top+t.y+"px"})},_panEndHandler:function(n,t){t&&(this._startRect.left+=t.x,this._startRect.top+=t.y)},_onZoomHandler:function(n,t,i){var r=this._startRect,u=r.width*t,f=r.height*t,o=r.left-(u-r.width)*(i.x-r.left)/r.width,s=r.top-(f-r.height)*(i.y-r.top)/r.height;e.set(this._canvas,{left:o+"px",top:s+"px",width:u+"px",height:f+"px"});this._endRect={left:o,top:s,width:u,height:f}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(n,t,i){e.set(this._canvas,{width:t+"px",height:i+"px"});this._startRect.width=this._canvas.width=t;this._startRect.height=this._canvas.height=i},_extentChangeHandler:function(){if(!this.suspended){this._fireUpdateStart();var n=this._map;this._requestData(n.extent,n.width,n.height)}},_visibilityChangeHandler:function(n){n?h.show(this._canvas):h.hide(this._canvas)},_opacityChangeHandler:function(n){e.set(this._canvas,"opacity",n)}})});
//# sourceMappingURL=BaseRasterLayer.min.js.map
