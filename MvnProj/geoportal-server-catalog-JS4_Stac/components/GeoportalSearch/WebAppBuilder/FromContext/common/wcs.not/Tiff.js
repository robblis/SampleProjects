define([],function(){"use strict";function t(){var t,n,i;return t=new ArrayBuffer(4),n=new Uint8Array(t),i=new Uint32Array(t),n[0]=1,n[1]=2,n[2]=3,n[3]=4,i[0]===67305985}function i(){var n=[];return n[254]="NEWSUBFILETYPE",n[255]="SUBFILETYPE",n[256]="IMAGEWIDTH",n[257]="IMAGELENGTH",n[258]="BITSPERSAMPLE",n[259]="COMPRESSION",n[262]="PHOTOMETRICINTERPRETATION",n[263]="THRESHHOLDING",n[264]="CELLWIDTH",n[265]="CELLLENGTH",n[266]="FILLORDER",n[269]="DOCUMENTNAME",n[270]="IMAGEDESCRIPTION",n[271]="MAKE",n[272]="MODEL",n[273]="STRIPOFFSETS",n[274]="ORIENTATION",n[277]="SAMPLESPERPIXEL",n[278]="ROWSPERSTRIP",n[279]="STRIPBYTECOUNTS",n[280]="MINSAMPLEVALUE",n[281]="MAXSAMPLEVALUE",n[282]="XRESOLUTION",n[283]="YRESOLUTION",n[284]="PLANARCONFIGURATION",n[285]="PAGENAME",n[286]="XPOSITION",n[287]="YPOSITION",n[288]="FREEOFFSETS",n[289]="FREEBYTECOUNTS",n[290]="GRAYRESPONSEUNIT",n[291]="GRAYRESPONSECURVE",n[292]="T4OPTIONS",n[293]="T6OPTIONS",n[296]="RESOLUTIONUNIT",n[297]="PAGENUMBER",n[300]="COLORRESPONSEUNIT",n[301]="TRANSFERFUNCTION",n[305]="SOFTWARE",n[306]="DATETIME",n[315]="ARTIST",n[316]="HOSTCOMPUTER",n[317]="PREDICTOR",n[318]="WHITEPOINT",n[319]="PRIMARYCHROMATICITIES",n[320]="COLORMAP",n[321]="HALFTONEHINTS",n[322]="TILEWIDTH",n[323]="TILELENGTH",n[324]="TILEOFFSETS",n[325]="TILEBYTECOUNTS",n[326]="BADFAXLINES",n[327]="CLEANFAXDATA",n[328]="CONSECUTIVEBADFAXLINES",n[330]="SUBIFD",n[332]="INKSET",n[333]="INKNAMES",n[334]="NUMBEROFINKS",n[336]="DOTRANGE",n[337]="TARGETPRINTER",n[338]="EXTRASAMPLES",n[339]="SAMPLEFORMAT",n[340]="SMINSAMPLEVALUE",n[341]="SMAXSAMPLEVALUE",n[342]="TRANSFERRANGE",n[512]="JPEGPROC",n[513]="JPEGIFOFFSET",n[514]="JPEGIFBYTECOUNT",n[515]="JPEGRESTARTINTERVAL",n[517]="JPEGLOSSLESSPREDICTORS",n[518]="JPEGPOINTTRANSFORM",n[519]="JPEGQTABLES",n[520]="JPEGDCTABLES",n[521]="JPEGACTABLES",n[529]="YCBCRCOEFFICIENTS",n[530]="YCBCRSUBSAMPLING",n[531]="YCBCRPOSITIONING",n[532]="REFERENCEBLACKWHITE",n[33432]="COPYRIGHT",n}var n={tags:i()};return n.decode=function(n){var t={};return this.readHeader(n,t),this.readIFD(n,t),this.parseData(n,t)},n.readHeader=function(n,t){var r,u,i,f,e;if(r=new DataView(n,0,8),u=r.getUint16(0,!1),u===18761)i=!0;else if(u===19789)i=!1;else throw"unexpected endianess byte";if(f=r.getUint16(2,i),f!==42)throw"unexpected tiff identifier";return e=r.getUint32(4,i),t.headerInfo={littleEndian:i,firstIFD:e},!0},n.getTagName=function(n){var t=this.tags[n];return t===undefined&&(t="unknown"+n),t},n.readIFD=function(n,t){var i,u,h,e,c,l,f,a,r,v,o,p,y,s;for(i=t.headerInfo.littleEndian,u=t.headerInfo.firstIFD,t.ifds=[];u;){for(h=new DataView(n,u,2).getUint16(0,i),e=u+2,u=new DataView(n,e+h*12,4).getUint32(0,i),y={},c=0;c<h;c++)(f=new DataView(n,e,12),a=f.getUint16(0,i),r=f.getUint16(2,i),v=f.getUint32(4,i),o=f.getUint32(8,i),e+=12,r===7||r>12)||(s={fieldTag:a,fieldType:r,fieldValueCount:v,fieldValueOffset:o},l=v*this.fieldTypeSize[r]*8,l<=32?(p=i?[o]:[o>>>32-l],s.fieldValues=p):this.readFieldValues(n,i,s),y[this.getTagName(a)]={type:r,values:s.fieldValues});t.ifds.push(y)}},n.parseData=function(n,t){if(t.ifds.length===0)throw"no valid ifd";var i,r;return i=t.ifds[0],i.TILEOFFSETS?r=this.parseTiledData(n,t):i.STRIPOFFSETS&&(r=this.parseScanlineData(n,t)),r},n.parseTiledData=function(n,i){var e,o,b,s,u,y,vt,p,k,w,tt,a,it,ft,h,c,f,d,r,g,et,ot,st,ht,ct,rt,ut,yt,pt,wt,bt,lt,l,v,nt,at;if(i.ifds.length===0)throw"no valid ifd";if(e=i.ifds[0],p=e.TILEOFFSETS?e.TILEOFFSETS.values:undefined,p!==undefined){if(k=e.TILEBYTECOUNTS.values,w=e.TILEWIDTH.values[0],tt=e.TILELENGTH.values[0],a=e.IMAGEWIDTH.values[0],it=e.IMAGELENGTH.values[0],o=a*it,s=e.BITSPERSAMPLE.values[0],u=e.SAMPLESPERPIXEL.values[0],y=e.SAMPLEFORMAT?e.SAMPLEFORMAT.values[0]:1,vt=e.PLANARCONFIGURATION?e.PLANARCONFIGURATION.values[0]:1,vt!==1){console.log("can only handle PLANARCONFIGURATION=1");throw"can only handle PLANARCONFIGURATION=1";}if(!(y>3)){if(y===3?(h=new Float32Array(o*u),c=Float32Array):y===1?s<=8?(h=new Uint8Array(o*u),c=Uint8Array):s<=16?(h=new Uint16Array(o*u),c=Uint16Array):s<=32&&(h=new Uint32Array(o*u),c=Uint32Array):y===2&&(s<=8?(h=new Int8Array(o*u),c=Int8Array):s<=16?(h=new Int16Array(o*u),c=Int16Array):s<=32&&(h=new Int32Array(o*u),c=Int32Array)),ht=Math.ceil(a/w),s%8==0)for(f=0;f<p.length;f++){if(ot=Math.floor(f/ht)*tt,st=f%ht*w,ct=(ot*a+st)*u,k[f]!==w*tt*u*s/8&&console.log("tile byte counts is different than expected"),b=this.getPixelType(y,s),bt=i.headerInfo.littleEndian,b==="U8"||b==="S8"||t()===bt)wt=n.slice(p[f],p[f]+k[f]),ft=new c(wt);else{lt=new ArrayBuffer(k[f]);l=new Uint8Array(n,p[f],k[f]);v=new Uint8Array(lt);switch(b){case"U16":case"S16":for(r=0;r<l.length;r+=2)v[r]=l[r+1],v[r+1]=l[r];break;case"U32":case"S32":case"F32":for(r=0;r<l.length;r+=4)v[r]=l[r+3],v[r+1]=l[r+2],v[r+2]=l[r+1],v[r+3]=l[r]}ft=new c(lt)}for(ut=0,rt=ct,pt=Math.min(w,a-st),yt=Math.min(tt,it-ot),g=0;g<yt;g++)for(rt=ct+g*a*u,ut=g*w*u,et=0;et<pt*u;et++,rt++,ut++)h[rt]=ft[ut]}if(nt={width:a,height:it,pixelType:b},u===1)nt.pixels=[h];else for(nt.pixels=[],f=0;f<u;f++){for(at=new c(o),d=0;d<o;d++)at[d]=h[d*u+f];nt.pixels.push(at)}return nt}}},n.parseScanlineData=function(n,i){var f,c,k,o,e,v,ft,y,d,p,w,b,et,tt,s,h,u,g,r,ot,st,it,rt,l,a,nt,ut;if(i.ifds.length===0)throw"no valid ifd";if(f=i.ifds[0],et=i.headerInfo.littleEndian,y=f.STRIPOFFSETS?f.STRIPOFFSETS.values:undefined,y!==undefined){if(d=f.STRIPBYTECOUNTS.values,p=f.ROWSPERSTRIP.values,w=f.IMAGEWIDTH.values[0],b=f.IMAGELENGTH.values[0],c=w*b,o=f.BITSPERSAMPLE.values[0],e=f.SAMPLESPERPIXEL.values[0],v=f.SAMPLEFORMAT?f.SAMPLEFORMAT.values[0]:1,ft=f.PLANARCONFIGURATION?f.PLANARCONFIGURATION.values[0]:1,ft!==1){console.log("can only handle PLANARCONFIGURATION=1");throw"can only handle PLANARCONFIGURATION=1";}if(!(v>3)){if(v===3?(s=new Float32Array(c*e),h=Float32Array):v===1?o<=8?(s=new Uint8Array(c*e),h=Uint8Array):o<=16?(s=new Uint16Array(c*e),h=Uint16Array):o<=32&&(s=new Uint32Array(c*e),h=Uint32Array):v===2&&(o<=8?(s=new Int8Array(c*e),h=Int8Array):o<=16?(s=new Int16Array(c*e),h=Int16Array):o<=32&&(s=new Int32Array(w*b*e),h=Int32Array)),k=this.getPixelType(v,o),it=p,o%8==0)for(u=0;u<y.length;u++){if(ot=u*p*w*e,it=(u+1)*p>b?b-u*p:p,d[u]!==it*w*e*o/8&&console.log("strip byte counts is different than expected"),k==="U8"||k==="S8"||t()===et)st=n.slice(y[u],y[u]+d[u]),tt=new h(st);else{rt=new ArrayBuffer(d[u]);l=new Uint8Array(n,y[u],d[u]);a=new Uint8Array(rt);switch(k){case"U16":case"S16":for(r=0;r<l.length;r+=2)a[r]=l[r+1],a[r+1]=l[r];break;case"U32":case"S32":case"F32":for(r=0;r<l.length;r+=4)a[r]=l[r+3],a[r+1]=l[r+2],a[r+2]=l[r+1],a[r+3]=l[r]}tt=new h(rt)}s.set(tt,ot)}if(nt={width:w,height:b,pixelType:k},e===1)nt.pixels=[s];else for(nt.pixels=[],u=0;u<e;u++){for(ut=new h(c),g=0;g<c;g++)ut[g]=s[g*e+u];nt.pixels.push(ut)}return nt}}},n.getPixelType=function(n,t){var i="UNKNOWN";return n===3?i="F32":n===1?t<=8?i="U8":t<=16?i="U16":t<=32&&(i="U32"):n===2&&(t<=8?i="S8":t<=16?i="S16":t<=32&&(i="S32")),i},n.fieldTypeSize=[0,1,1,2,4,8,1,1,2,4,8,4,8],n.readFieldValues=function(n,t,i){var e,h,f,o,u,r,s,c;for(e=i.fieldType,h=i.fieldValueCount,f=i.fieldValueOffset,o=[],r=f,s=this.fieldTypeSize[e],c=h*s,r=f;r<f+c;r+=s){switch(e){case 1:u=new DataView(n,r,1).getUint8(0);break;case 2:u=new DataView(n,r,1).getUint8(0)<<1;break;case 3:u=new DataView(n,r,2).getUint16(0,t);break;case 4:u=new DataView(n,r,4).getUint32(0,t);break;case 5:u=new DataView(n,r,4).getUint32(0,t)/new DataView(n,r+4,4).getUint32(0,t);break;case 6:u=new DataView(n,r,1).getInt8(0);break;case 8:u=new DataView(n,r,2).getInt16(0,t);break;case 9:u=new DataView(n,r,4).getInt32(0,t);break;case 10:u=new DataView(n,r,4).getInt32(0,t)/new DataView(n,r+4,4).getInt32(0,t);break;case 11:u=new DataView(n,r,4).getFloat32(0,t);break;case 12:u=new DataView(n,r,8).getFloat64(0,t)}o.push(u)}i.fieldValues=o},n});
//# sourceMappingURL=Tiff.min.js.map
